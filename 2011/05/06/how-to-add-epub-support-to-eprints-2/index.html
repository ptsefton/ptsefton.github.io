
<html>
<head>
    <title>ptsefton.com :: How to add EPUB support to EPrints</title>
<style>
.header {
    
  background-color: #ff00ff;
  border-color: #b72bc0;
  color: #ffff00;
  padding-top: 12pt;
  padding-bottom: 12pt;
  font-family: monospace;
}




/* unvisited link */
a:link {
    color: #FF00FF;
}

.header a:link {
    color: #FFFF00;
    text-decoration: none; 
}

button {
    color: #ffff00;
    background-color: #ff00ff;
    font-family: monospace;
}

/* visited link */
a:visited {
    color: #FF00AA;
}

.header a:visited {
    color: #FFFF00;
}

h1, h2 {
    color: # FF00FF
}

/* mouse over link */
a:hover {
    color: #FF00AA;
}

/* selected link */
a:active {
    color: #0000FF;
}

a {
    text-decoration: none; 
}

img {
    max-width: 100%
}
section img {
    width: 100%
}
td, th {
    padding-top: 20px;
    padding-right: 20px;
    vertical-align: top;
    text-align: left;
}

.content {
	font-family: Verdana, system-ui, Helvetica, sans-serif;
    line-height: 1.8em;
    }



@media  screen and (min-width:  900px) {
    .content, .header {
        width: 60%;
        padding-left: 20%;
        padding-right: 30%;
    }
    
}

@media  screen and (min-width: 1200px) {
    .content, .header {
        width: 40%;
        padding-left: 20%;
        padding-right: 30%;
    }
    
}


</style>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-898010-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6JNHBJL67Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6JNHBJL67Q');
</script>
<body>
<div class="header">
<h2><a href="/">[ptsefton.com]</a> | <a href="/Pages/cv.html"> [CV & Bio] </a></h2>


</div>


<div class="content">
<h1> 
How to add EPUB support to EPrints 
</h1>
<h2>2011-05-06 </h2>

<div>
<div class="page-toc">
</div>
<div>
<p>[This is a repost from the JISCPub project <span
class="spCh spChx2013">–</span> please comment over there
<a href="http://jiscpub.blogs.edina.ac.uk/2011/05/03/how-to-add-epub-support-to-eprints-8/"><span>http://jiscpub.blogs.edina.ac.uk/2011/05/03/how-to-add-epub-support-to-eprints-8/</span></a>
]</p>
<p>In a <a href="http://ptsefton.com/2011/04/12/metadata-in-word-processing-monographs.htm">previous post here on the jiscPUB projec<span
style="color:#000000; "><span
class="T1">t</span></span></a><span
style="color:#000000; "><span class="T1"> I sai</span></span>d it would
be good for the EPrints repository software to support EPUB uploads.</p>
<blockquote>
<p>I<span class="spCh spChx2019">’</span>d love to do something with a
repository <span class="spCh spChx2013">–</span> I<span
class="spCh spChx2019">’</span>m thinking that it would be great to
deposit theses in EPUB format <span
class="spCh spChx2013">–</span> and the repository could provided a
web-based reader, along the lines
of <a href="http://ibisreader.com/"><span>IbisReader</span></a>, which Liza Daly
and company created. I<span class="spCh spChx2019">’</span>m looking
at you, Eprints! Eprints already almost supports this, if you upload a
zip file it will stash all the parts for you in a single record. All
we would need would be something like this<a href="../little%20reader%20my%20colleagues%20at%20USQ%20made"><span> little reader my
colleagues at USQ
made</span></a>.
It would just be a matter of transforming the EPUB TOC into JSON, and
loading the JavaScript into an Eprints page.</p>
</blockquote>
<p>I Called Les Carr's attention to the post and he responded:</p>
<blockquote>
<p><a href="https://twitter.com/#!/lescarr"><span>lescarr</span></a>
<a href="https://twitter.com/#!/ptsefton"><span>@ptsefton</span></a> just tell us
what to do and we'll do it.</p>
</blockquote>
<p>OK. Here goes with my specification for how EPrints could add at least
basic support for EPUB.</p>
<h1><span id="id2"></span><span></span></a>Putting EPUB into EPrints as-is</h1>
<p>To explore this, I ran the <a href="http://wiki.eprints.org/w/EPrints_Live_CD_Help"><span>EPrints live
CD</span></a>
(livecd_v3.1-x.iso) under VirtualBox on Windows 7 <span
class="spCh spChx2013">–</span> this worked well when I gave it a decent
amount of memory <span class="spCh spChx2013">–</span> it didn't manage
to boot in several hours at 256Mb. (Note that no repositories were
harmed in the making of this post <span class="spCh spChx2013">–</span>
I did not change the Eprints code at all.)</p>
<p>The EPUB format is a zipfile containing some XHTML payload documents, a
manifest, and a table of contents. On one level EPRINTS already supports
this, in that there is support for uploading ZIP files. I tested this
using Danny Kingsley's thesis (as received, with no massaging or adding
metadata apart from tweaking the title in Word) <a href="http://dl.dropbox.com/u/24994372/Formatted_PhD_12May09.epub"><span>converted to
EPUB</span></a>
via the ICE service <a href="http://ec2-50-16-170-243.compute-1.amazonaws.com/api/convert/doc"><span>I have been working
on</span></a>.</p>
<p>The procedure:</p>
<ol>
<li>
<p>Generated an EPUB using ICE.</p>
</li>
<li>
<p>Changed the file extension to .zip.</p>
</li>
<li>
<p>Uploaded it into EPrints.</p>
</li>
</ol>
<p>The result is an EPrints item with many parts. If you click on any of
the HTML files that make up the thesis then they work as web pages <span
class="spCh spChx2013">–</span> ie the table of contents (if you can
find it amongst the many files) links to the other pages. But there is
no navigation to tie it all together you have to keep hitting back <span
class="spCh spChx2013">–</span> each HTML page from the EPUB is a stand
alone fragment.</p>
<p><span
style="display: block"><a><span></span></a><img src="/wp-content/uploads/2011/05/ma53f402_643x400.jpeg" alt="graphics1"></span>Illustration
1: The management interface in EPrints showing all the parts of an EPUB
file which has been uploaded and saved as a series of parts in a single
record.</p>
<p>At this point I went off on a side trip, and <a href="http://ptsefton.com/2011/04/15/introducing-epub2html-adding-a-plain-html-view-to-an-epub.htm">wrote this little tool
<span class="spCh spChx2013">–</span> to add an HTML view to an EPUB
file</a>.</p>
<h1><span id="id3"></span><span></span></a>Putting enhanced EPUB into Eprints</h1>
<p>Now, lets try that again with <a href="http://dl.dropbox.com/u/24994372/Formatted_PhD_12May09.epub"><span>the
version</span></a>
where I added an HTML index page to the EPUB using the new demo tool,
epub2html. I uploaded the file, clicked around semi-randomly until I
figured out how to see all the files listed from the zip, and selected
index.html as the 'main' file. From memory I thought the repository
would do that for me but it didn't. Anyway, I ended up with this:</p>
<p><span
style="display: block"><a><span></span></a><img src="/wp-content/uploads/2011/05/5fc3b428_643x332.jpeg" alt="graphics3"></span>Illustration
2: The details screen that users see - clicking on the description takes
you to the HTML page I picked as the main file.</p>
<p><span
style="display: block"><a><span></span></a><img src="/wp-content/uploads/2011/05/m629e91b8_643x417.jpeg" alt="graphics2"></span>Illustration
3: A rudimentary ebook reader using an inline frame.</p>
<p>If I click on the link starting with Other, there we have it <span
class="spCh spChx2013">–</span> more-or-less working navigation within
the limits of this demo-quality software. All I had to do was change the
extension from .epub to .zip and select the entry page, and I had a
working, navigable document.
The initial version of epub2html used the unsupported epubjs as a web
based reader-application <span class="spCh spChx2013">–</span> but Liza
Daly suggested I use the more up to date Monocle.js library instead. I
tried that but I'm afraid the amount of setup required is too much for
the moment so what you see here is an HTML page with an inline frame for
the content.</p>
<h1><span id="id4"></span><span></span></a>What does the repository need to do?</h1>
<p>So what does the EPrints team need to do to support EPUB a bit better?</p>
<ul>
<li>
<p>Add EPUB to the list of recognised files.</p>
</li>
<li>
<p>Upon recognising an EPUB...</p>
<ul>
<li>
<p>Use a service like epub2html that can generate an HTML view of
the EPUB. I wrote mine in Python, Eprints is written in Perl but
I'm sure that can be sorted out via a re-write or a web service
or something<span class="footnote"
style="vertical-align: super;"><span
id="ftn1-text"><a href="#ftn1"><span>*</span></a></span></span>.</p>
</li>
<li>
<p>Allow the user to download the whole EPUB, or choose to use an
online viewer. Could be static HTML, frames (not nice), or some
kind of JavaScript based viewer.</p>
</li>
<li>
<p>Embed some kind of viewer in the EPrints page itself, or at
least provide a back-link in the document viewer to the EPrints
page.</p>
</li>
</ul>
</li>
</ul>
<p>Does that make sense, Les?</p>
<p>[This is a repost from the JISCPub project <span
class="spCh spChx2013">–</span> please comment over there
<a href="http://jiscpub.blogs.edina.ac.uk/2011/05/03/how-to-add-epub-support-to-eprints-8/"><span>http://jiscpub.blogs.edina.ac.uk/2011/05/03/how-to-add-epub-support-to-eprints-8/</span></a>
]</p>
<p>Copyright <span rel="http://purl.org/dc/elements/1.1/creator"
resource="http://trove.nla.gov.au/people/541658"><span
property="http://xmlns.com/foaf/0.1/name"
resource="http://trove.nla.gov.au/people/541658">Peter
Sefton</span></span>, 2011-04-15. Licensed under <span
rel="http://creativecommons.org/licence">Creative Commons
Attribution-Share Alike 2.5 Australia</span>.
&lt;http://creativecommons.org/licenses/by-sa/2.5/au/&gt;</p>
<p>This post was written in OpenOffice.org, using templates and tools
provided by the <a href="http://ice.usq.edu.au/"><span>Integrated Content
Environment</span></a> project.</p>
<hr>
<div class="footnote-defined">
<p><span id="ftn1"><a href="#ftn1-text"><span>*</span></a></span> Maybe there's a
Python interpreter written in Perl?</p>
</div>
</div>
</div>

</div><script src="https://utteranc.es/client.js"
        repo="ptsefton/blog-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script></body>
</html>